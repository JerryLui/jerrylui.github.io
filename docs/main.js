var g=Object.defineProperty;var T=(n,t,e)=>t in n?g(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var s=(n,t,e)=>T(n,typeof t!="symbol"?t+"":t,e);import*as i from"three";import*as a from"three";var m=class{constructor(t,e){s(this,"mesh");s(this,"velocity",0);s(this,"gravity",-9.82);s(this,"dampening");s(this,"clickBoostVelocity");s(this,"maxHeight",5);s(this,"minHeight",.55);this.dampening=e.dampening??.46,this.clickBoostVelocity=e.clickBoostVelocity??3;let r=new a.MeshStandardMaterial({color:e.color??16744272});this.mesh=new a.Mesh(e.geometry,r),this.mesh.castShadow=!0,this.mesh.position.copy(e.position??new a.Vector3(0,4,0)),t.add(this.mesh)}getMesh(){return this.mesh}onClick(){this.velocity=this.clickBoostVelocity}update(t){this.velocity+=this.gravity*t,this.mesh.position.y+=this.velocity*t,this.mesh.position.y>=this.maxHeight&&(this.mesh.position.y=this.maxHeight,this.velocity=0),this.mesh.position.y<=this.minHeight&&(this.mesh.position.y=this.minHeight,this.velocity=-this.velocity*this.dampening,Math.abs(this.velocity)<.01&&(this.velocity=0))}},d=class extends m{constructor(t){super(t,{geometry:new a.SphereGeometry(.3,32,32),position:new a.Vector3(-1,4,0),dampening:.7,clickBoostVelocity:2.5})}},p=class extends m{constructor(t){super(t,{geometry:new a.BoxGeometry(.6,.6,.6),color:4286945,position:new a.Vector3(1,4,0),dampening:.4,clickBoostVelocity:1.4})}};var E=class{constructor(){s(this,"scene");s(this,"camera");s(this,"renderer");s(this,"shapes",[]);s(this,"lastTime",0);s(this,"raycaster");s(this,"mouse");this.scene=new i.Scene,this.camera=new i.PerspectiveCamera(45,globalThis.innerWidth/globalThis.innerHeight,.1,1e3),this.renderer=new i.WebGLRenderer({antialias:!0}),this.raycaster=new i.Raycaster,this.mouse=new i.Vector2,this.setupRenderer(),this.createGround(),this.setupLights(),this.setupCamera(),this.setupEventListeners();let t=new d(this.scene),e=new p(this.scene);this.shapes.push({mesh:t.getMesh(),shape:t},{mesh:e.getMesh(),shape:e}),this.lastTime=performance.now()/1e3,this.loop()}setupRenderer(){this.renderer.setSize(globalThis.innerWidth,globalThis.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=i.PCFSoftShadowMap,globalThis.document.body.appendChild(this.renderer.domElement)}createGround(){let t=new i.BoxGeometry(10,.5,10),e=this.createGroundMaterials(),r=new i.Mesh(t,e);r.receiveShadow=!0,this.scene.add(r)}createGroundMaterials(){return[this.createSedimentMaterial(),this.createSedimentMaterial(),new i.MeshStandardMaterial({color:16777120,roughness:.8}),this.createSedimentMaterial(),this.createSedimentMaterial(),this.createSedimentMaterial()]}createSedimentMaterial(){let e=document.createElement("canvas");e.width=128,e.height=128;let r=e.getContext("2d");if(!r)return new i.MeshStandardMaterial({color:8421504});let o=[{color:"#D2B48C",name:"Light tan"},{color:"#8B7355",name:"Medium brown"},{color:"#6B4423",name:"Dark brown"},{color:"#463E3F",name:"Deep brown"},{color:"#2F1F1F",name:"Almost black"}];this.drawSedimentLayers(r,o,128);let c=new i.CanvasTexture(e);return new i.MeshStandardMaterial({map:c,roughness:.9,metalness:.1})}drawSedimentLayers(t,e,r){let o=r/e.length;e.forEach((c,h)=>{let l=t.createLinearGradient(0,h*o,0,(h+1)*o);l.addColorStop(0,c.color),l.addColorStop(1,e[Math.min(h+1,e.length-1)].color),t.fillStyle=l,t.fillRect(0,h*o,r,o),this.addLayerNoise(t,h*o,o,r)})}addLayerNoise(t,e,r,o,c=100){t.fillStyle="rgba(0,0,0,0.1)";for(let h=0;h<c;h++){let l=Math.random()*o,u=e+Math.random()*r;t.fillRect(l,u,1,1)}}setupLights(){let t=new i.AmbientLight(16777215,.5);this.scene.add(t);let e=new i.DirectionalLight(16777215,1);e.position.set(0,10,0),e.castShadow=!0,e.shadow.camera.near=.1,e.shadow.camera.far=20,e.shadow.camera.left=-5,e.shadow.camera.right=5,e.shadow.camera.top=5,e.shadow.camera.bottom=-5,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,this.scene.add(e)}setupCamera(){this.camera.position.set(10,12,10),this.camera.lookAt(0,0,0)}setupEventListeners(){globalThis.addEventListener("resize",()=>{this.camera.aspect=globalThis.innerWidth/globalThis.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(globalThis.innerWidth,globalThis.innerHeight)}),globalThis.addEventListener("click",t=>{this.mouse.x=t.clientX/globalThis.innerWidth*2-1,this.mouse.y=-(t.clientY/globalThis.innerHeight)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);for(let{mesh:e,shape:r}of this.shapes)this.raycaster.intersectObject(e).length>0&&r.onClick()})}loop(){let t=performance.now()/1e3,e=t-this.lastTime;e>.1&&(e=1/60),this.lastTime=t;for(let{shape:r}of this.shapes)r.update(e);this.renderer.render(this.scene,this.camera),globalThis.requestAnimationFrame(()=>this.loop())}};new E;
