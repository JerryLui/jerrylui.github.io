var c=Object.defineProperty;var l=(o,e,t)=>e in o?c(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>l(o,typeof e!="symbol"?e+"":e,t);import*as a from"three";import{OrbitControls as p}from"three/addons/controls/OrbitControls.js";import{GLTFLoader as m}from"three/addons/loaders/GLTFLoader.js";import{DRACOLoader as u}from"three/addons/loaders/DRACOLoader.js";var h=class{constructor(){r(this,"container");r(this,"progressBar");r(this,"currentProgress",0);r(this,"targetProgress",0);r(this,"MINIMUM_LOAD_TIME",2e3);r(this,"loadStartTime");r(this,"isAnimating",!0);r(this,"onComplete");r(this,"animate",()=>{this.isAnimating&&(this.targetProgress<90&&this.currentProgress<90&&(this.targetProgress+=.1),this.currentProgress+=(this.targetProgress-this.currentProgress)*.1,this.progressBar.style.width=`${this.currentProgress}%`,requestAnimationFrame(this.animate))});this.container=document.querySelector(".loading-bar"),this.progressBar=document.querySelector(".loading-progress"),this.loadStartTime=performance.now(),this.animate()}updateProgress(e){this.targetProgress=e}hide(e){this.onComplete=e;let t=performance.now()-this.loadStartTime,i=Math.max(0,this.MINIMUM_LOAD_TIME-t);this.targetProgress=100,setTimeout(()=>{this.isAnimating=!1,this.container.style.display="none",this.onComplete?.()},i)}showError(){this.container.style.backgroundColor="rgba(255, 0, 0, 0.3)",this.isAnimating=!1}},d=class{constructor(){r(this,"scene");r(this,"camera");r(this,"renderer");r(this,"controls");r(this,"room",null);r(this,"axesHelper");r(this,"chair",null);r(this,"isRotating",!1);r(this,"targetRotation",0);r(this,"startRotation",0);r(this,"raycaster");r(this,"ROTATION_ANGLE",Math.PI/6);r(this,"ANIMATION_DURATION",1e3);r(this,"animationStartTime",0);r(this,"BOUNCEABLE_OBJECT_NAMES",["Mouse","Keyboard","KeyboardBase"]);r(this,"bounceableObjects",[]);r(this,"GRAVITY",-2.45);r(this,"DAMPENING",.6);r(this,"loadingBar");r(this,"sceneLoaded",!1);r(this,"loadedModel");this.scene=new a.Scene,this.camera=new a.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new a.WebGLRenderer({antialias:!0,powerPreference:"high-performance"}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=a.PCFSoftShadowMap,this.renderer.outputColorSpace=a.SRGBColorSpace,this.renderer.toneMapping=a.ACESFilmicToneMapping,this.renderer.toneMappingExposure=1,this.renderer.setPixelRatio(window.devicePixelRatio),document.body.appendChild(this.renderer.domElement),this.camera.position.set(4,4,4),this.camera.lookAt(0,0,0),this.controls=new p(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.enableZoom=!0,this.controls.enablePan=!1,this.controls.minPolarAngle=Math.PI/4,this.controls.maxPolarAngle=Math.PI/3,this.controls.minAzimuthAngle=Math.PI/6,this.controls.maxAzimuthAngle=Math.PI/3,this.setupLights(),this.raycaster=new a.Raycaster,this.loadingBar=new h,this.loadRoom(),this.setupEventListeners(),this.animate(performance.now())}setupLights(){let e=new a.AmbientLight(16777215,.6);this.scene.add(e)}setupWindowLight(e){let t=new a.Vector3;e.getWorldPosition(t),t.z-=.06,t.y+=.06;let i=new a.PointLight(16765582,1,0);i.position.copy(t),i.castShadow=!0,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,i.shadow.bias=-.001,this.scene.add(i)}setupLampLight(e){let t=new a.Vector3;e.getWorldPosition(t),t.y+=.06,t.z+=.04;let i=new a.PointLight(16765582,.1,5,1);i.castShadow=!0,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,i.shadow.bias=-.001,i.position.copy(t);let s=new a.SpotLight(16765582,1);s.position.copy(t),s.angle=Math.PI/4,s.penumbra=.2,s.decay=2,s.distance=10,s.castShadow=!0,s.shadow.mapSize.width=1024,s.shadow.mapSize.height=1024,s.shadow.bias=-.001;let n=new a.Object3D;this.scene.add(n),s.target=n,n.position.set(0,-1,0),this.scene.add(i),this.scene.add(s)}enhanceMaterial(e){!e.material||!(e.material instanceof a.MeshStandardMaterial)||(e.castShadow=!0,e.receiveShadow=!0,e.material.envMapIntensity=1.5,e.material.metalness=e.material.metalness||0,e.material.roughness=Math.max(.3,e.material.roughness||1),(e.name==="Glass"||e.name.includes("Glass"))&&(e.material.emissive=new a.Color(16765582),e.material.emissiveIntensity=.9),e.material.needsUpdate=!0)}loadRoom(){let e=new m,t=new u;t.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),t.setDecoderConfig({type:"js"}),e.setDRACOLoader(t),e.load("room.glb",i=>{this.loadedModel=i.scene,this.setupLoadedModel(),this.loadingBar.hide(()=>{this.room=this.loadedModel,this.scene.add(this.room)})},i=>{if(i.lengthComputable){let s=i.loaded/i.total*100;this.loadingBar.updateProgress(s)}},i=>{console.error("Error loading room:",i),this.loadingBar.showError()})}setupLoadedModel(){if(!this.loadedModel)return;this.chair=this.loadedModel.getObjectByName("Chair"),this.chair&&(this.setupChairInteraction(),setTimeout(()=>this.startChairRotation(),1e3)),this.BOUNCEABLE_OBJECT_NAMES.forEach(i=>{let s=this.loadedModel?.getObjectByName(i);s&&this.setupBounceableObject(s)}),this.loadedModel.traverse(i=>{i.name==="WindowGlass"||i.name.includes("WindowGlass")?this.setupWindowLight(i):(i.name==="TableLampShade"||i.name.includes("TableLampShade"))&&this.setupLampLight(i),i instanceof a.Mesh&&this.enhanceMaterial(i)});let t=new a.Box3().setFromObject(this.loadedModel).getCenter(new a.Vector3);this.loadedModel.position.sub(t)}setupChairInteraction(){let e=new a.Vector2;window.addEventListener("click",t=>{e.x=t.clientX/window.innerWidth*2-1,e.y=-(t.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(e,this.camera),this.raycaster.intersectObject(this.chair,!0).length>0&&!this.isRotating&&this.startChairRotation()})}startChairRotation(){this.chair&&(this.startRotation=this.chair.rotation.y,this.targetRotation=Math.abs(this.startRotation)<.01?this.ROTATION_ANGLE:0,this.isRotating=!0,this.animationStartTime=performance.now())}updateChairRotation(e){if(!this.chair||!this.isRotating)return;let t=e-this.animationStartTime,i=Math.min(t/this.ANIMATION_DURATION,1);if(i<1){let s=this.easeInOutQuad(i);this.chair.rotation.y=this.startRotation+(this.targetRotation-this.startRotation)*s}else this.chair.rotation.y=this.targetRotation,this.isRotating=!1}setupBounceableObject(e){let t=new a.Vector3;e.getWorldPosition(t);let i=t.y;e.position.y=i+.3,this.bounceableObjects.push({object:e,initialY:i,velocity:0})}setupEventListeners(){window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}),window.addEventListener("click",e=>{let t=new a.Vector2;t.x=e.clientX/window.innerWidth*2-1,t.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(t,this.camera);for(let i of this.bounceableObjects)if(this.raycaster.intersectObject(i.object,!0).length>0){i.velocity=.8;break}})}easeInOutQuad(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}updateBounceableObjects(e){for(let t of this.bounceableObjects)t.velocity+=this.GRAVITY*e,t.object.position.y+=t.velocity*e,t.object.position.y<=t.initialY&&(t.object.position.y=t.initialY,t.velocity=-t.velocity*this.DAMPENING,Math.abs(t.velocity)<.01&&(t.velocity=0))}animate(e){requestAnimationFrame(t=>this.animate(t)),this.isRotating&&this.updateChairRotation(e),this.updateBounceableObjects(.016),this.controls.update(),this.renderer.render(this.scene,this.camera)}};new d;
