var l=Object.defineProperty;var p=(s,e,t)=>e in s?l(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var r=(s,e,t)=>p(s,typeof e!="symbol"?e+"":e,t);import*as i from"three";import{OrbitControls as m}from"three/addons/controls/OrbitControls.js";import{GLTFLoader as E}from"three/addons/loaders/GLTFLoader.js";import{DRACOLoader as w}from"three/addons/loaders/DRACOLoader.js";var c=class{constructor(){r(this,"scene");r(this,"camera");r(this,"renderer");r(this,"controls");r(this,"room",null);r(this,"axesHelper");r(this,"chair",null);r(this,"isRotating",!1);r(this,"targetRotation",0);r(this,"startRotation",0);r(this,"raycaster");r(this,"ROTATION_ANGLE",Math.PI/6);r(this,"ANIMATION_DURATION",1e3);r(this,"animationStartTime",0);r(this,"BOUNCEABLE_OBJECT_NAMES",["Mouse","Keyboard","KeyboardBase"]);r(this,"bounceableObjects",[]);r(this,"GRAVITY",-2.45);r(this,"DAMPENING",.6);this.scene=new i.Scene,this.camera=new i.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new i.WebGLRenderer({antialias:!0,powerPreference:"high-performance"}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=i.PCFSoftShadowMap,this.renderer.outputColorSpace=i.SRGBColorSpace,this.renderer.toneMapping=i.ACESFilmicToneMapping,this.renderer.toneMappingExposure=1,this.renderer.setPixelRatio(window.devicePixelRatio),document.body.appendChild(this.renderer.domElement),this.camera.position.set(7.07,12,7.07),this.camera.lookAt(0,0,0),this.controls=new m(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.enableZoom=!0,this.controls.enablePan=!1,this.controls.minPolarAngle=Math.PI/4,this.controls.maxPolarAngle=Math.PI/3,this.controls.minAzimuthAngle=Math.PI/4,this.controls.maxAzimuthAngle=Math.PI/4,this.setupLights(),this.raycaster=new i.Raycaster,this.loadRoom(),this.setupEventListeners(),this.animate(performance.now())}setupLights(){let e=new i.AmbientLight(16777215,.6);this.scene.add(e)}setupWindowLight(e){let t=new i.Vector3;e.getWorldPosition(t),t.z-=.06,t.y+=.06;let a=new i.PointLight(16765582,1,0);a.position.copy(t),a.castShadow=!0,a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,a.shadow.bias=-.001,this.scene.add(a)}setupLampLight(e){let t=new i.Vector3;e.getWorldPosition(t),t.y+=.06,t.z+=.04;let a=new i.PointLight(16765582,.1,5,1);a.castShadow=!0,a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,a.shadow.bias=-.001,a.position.copy(t);let n=new i.SpotLight(16765582,1);n.position.copy(t),n.angle=Math.PI/4,n.penumbra=.2,n.decay=2,n.distance=10,n.castShadow=!0,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024,n.shadow.bias=-.001;let h=new i.Object3D;this.scene.add(h),n.target=h,h.position.set(0,-1,0),this.scene.add(a),this.scene.add(n)}enhanceMaterial(e){!e.material||!(e.material instanceof i.MeshStandardMaterial)||(e.castShadow=!0,e.receiveShadow=!0,e.material.envMapIntensity=1.5,e.material.metalness=e.material.metalness||0,e.material.roughness=Math.max(.3,e.material.roughness||1),(e.name==="Glass"||e.name.includes("Glass"))&&(e.material.emissive=new i.Color(16765582),e.material.emissiveIntensity=.9),e.material.needsUpdate=!0)}loadRoom(){let e=new E,t=new w;t.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),t.setDecoderConfig({type:"js"}),e.setDRACOLoader(t),e.load("room.glb",a=>{this.room=a.scene,this.scene.add(this.room),this.chair=this.room.getObjectByName("Chair"),this.chair&&this.setupChairInteraction(),this.BOUNCEABLE_OBJECT_NAMES.forEach(o=>{let d=this.room?.getObjectByName(o);d&&this.setupBounceableObject(d)}),this.room.traverse(o=>{o.name==="WindowGlass"||o.name.includes("WindowGlass")?this.setupWindowLight(o):(o.name==="TableLampShade"||o.name.includes("TableLampShade"))&&this.setupLampLight(o),o instanceof i.Mesh&&this.enhanceMaterial(o)});let h=new i.Box3().setFromObject(this.room).getCenter(new i.Vector3);this.room.position.sub(h)},a=>{console.log("Loading progress:",a.loaded/a.total*100+"%")},a=>{console.error("Error loading room:",a)})}setupChairInteraction(){let e=new i.Vector2;window.addEventListener("click",t=>{e.x=t.clientX/window.innerWidth*2-1,e.y=-(t.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(e,this.camera),this.raycaster.intersectObject(this.chair,!0).length>0&&!this.isRotating&&this.startChairRotation()})}startChairRotation(){this.chair&&(this.startRotation=this.chair.rotation.y,this.targetRotation=Math.abs(this.startRotation)<.01?this.ROTATION_ANGLE:0,this.isRotating=!0,this.animationStartTime=performance.now())}updateChairRotation(e){if(!this.chair||!this.isRotating)return;let t=e-this.animationStartTime,a=Math.min(t/this.ANIMATION_DURATION,1);if(a<1){let n=this.easeInOutQuad(a);this.chair.rotation.y=this.startRotation+(this.targetRotation-this.startRotation)*n}else this.chair.rotation.y=this.targetRotation,this.isRotating=!1}setupBounceableObject(e){let t=new i.Vector3;e.getWorldPosition(t);let a=t.y;e.position.y=a+.3,this.bounceableObjects.push({object:e,initialY:a,velocity:0})}setupEventListeners(){window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}),window.addEventListener("click",e=>{let t=new i.Vector2;t.x=e.clientX/window.innerWidth*2-1,t.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(t,this.camera);for(let a of this.bounceableObjects)if(this.raycaster.intersectObject(a.object,!0).length>0){a.velocity=.8;break}})}easeInOutQuad(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}updateBounceableObjects(e){for(let t of this.bounceableObjects)t.velocity+=this.GRAVITY*e,t.object.position.y+=t.velocity*e,t.object.position.y<=t.initialY&&(t.object.position.y=t.initialY,t.velocity=-t.velocity*this.DAMPENING,Math.abs(t.velocity)<.01&&(t.velocity=0))}animate(e){requestAnimationFrame(t=>this.animate(t)),this.isRotating&&this.updateChairRotation(e),this.updateBounceableObjects(.016),this.controls.update(),this.renderer.render(this.scene,this.camera)}};new c;
